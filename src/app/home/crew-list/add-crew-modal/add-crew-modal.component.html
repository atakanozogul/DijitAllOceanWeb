<h1 mat-dialog-title>{{ isEditMode ? 'Edit Crew' : 'Add Crew' }}</h1>
<div mat-dialog-content>
  <form [formGroup]="crewForm">
    <mat-form-field appearance="fill">
      <mat-label>First Name</mat-label>
      <input matInput formControlName="firstName" required>
      <mat-error *ngIf="crewForm.get('firstName')?.hasError('required')">
        First Name is required
      </mat-error>
    </mat-form-field>
    <mat-form-field appearance="fill">
      <mat-label>Last Name</mat-label>
      <input matInput formControlName="lastName" required>
      <mat-error *ngIf="crewForm.get('lastName')?.hasError('required')">
        Last Name is required
      </mat-error>
    </mat-form-field>
    <mat-form-field appearance="fill">
      <mat-label>Nationality</mat-label>
      <mat-select formControlName="nationality" required>
        <mat-option *ngFor="let nationality of nationalities" [value]="nationality">
          {{ nationality }}
        </mat-option>
      </mat-select>
      <mat-error *ngIf="crewForm.get('nationality')?.hasError('required')">
        Nationality is required
      </mat-error>
    </mat-form-field>
    <mat-form-field appearance="fill">
      <mat-label>Title</mat-label>
      <mat-select formControlName="title" required>
        <mat-option *ngFor="let title of titles" [value]="title">
          {{ title }}
        </mat-option>
      </mat-select>
      <mat-error *ngIf="crewForm.get('title')?.hasError('required')">
        Title is required
      </mat-error>
    </mat-form-field>
    <mat-form-field appearance="fill">
      <mat-label>Days On Board</mat-label>
      <input matInput type="number" formControlName="daysOnBoard" min="0" required>
      <mat-error *ngIf="crewForm.get('daysOnBoard')?.hasError('required')">
        Days On Board is required
      </mat-error>
      <mat-error *ngIf="crewForm.get('daysOnBoard')?.hasError('min')">
        Days On Board cannot be less than 0
      </mat-error>
    </mat-form-field>
    <mat-form-field appearance="fill">
      <mat-label>Daily Rate</mat-label>
      <input matInput type="number" formControlName="dailyRate" min="0" required>
      <mat-error *ngIf="crewForm.get('dailyRate')?.hasError('required')">
        Daily Rate is required
      </mat-error>
      <mat-error *ngIf="crewForm.get('dailyRate')?.hasError('min')">
        Daily Rate cannot be less than 0
      </mat-error>
    </mat-form-field>
    <mat-form-field appearance="fill">
      <mat-label>Currency</mat-label>
      <mat-select formControlName="currency" required>
        <mat-option *ngFor="let currency of currencies" [value]="currency">
          {{ currency }}
        </mat-option>
      </mat-select>
      <mat-error *ngIf="crewForm.get('currency')?.hasError('required')">
        Currency is required
      </mat-error>
    </mat-form-field>
  </form>

  <h2 mat-subheader>Add or Edit Certificate</h2>
  <form [formGroup]="certificateForm">
    <mat-form-field appearance="fill">
      <mat-label>Certificate</mat-label>
      <mat-select formControlName="certificateId" required>
        <mat-option *ngFor="let certificate of certificates" [value]="certificate.id">
          {{ certificate.name }}
        </mat-option>
      </mat-select>
      <mat-error *ngIf="certificateForm.get('certificateId')?.hasError('required')">
        Certificate is required
      </mat-error>
    </mat-form-field>
    <mat-form-field appearance="fill">
      <mat-label>Issue Date</mat-label>
      <input matInput [matDatepicker]="issueDatePicker" formControlName="issueDate" required>
      <mat-datepicker-toggle matSuffix [for]="issueDatePicker"></mat-datepicker-toggle>
      <mat-datepicker #issueDatePicker></mat-datepicker>
      <mat-error *ngIf="certificateForm.get('issueDate')?.hasError('required')">
        Issue Date is required
      </mat-error>
    </mat-form-field>
    <mat-form-field appearance="fill">
      <mat-label>Expiry Date</mat-label>
      <input matInput [matDatepicker]="expiryDatePicker" formControlName="expiryDate" required>
      <mat-datepicker-toggle matSuffix [for]="expiryDatePicker"></mat-datepicker-toggle>
      <mat-datepicker #expiryDatePicker></mat-datepicker>
      <mat-error *ngIf="certificateForm.get('expiryDate')?.hasError('required')">
        Expiry Date is required
      </mat-error>
    </mat-form-field>
    <button mat-raised-button color="primary" (click)="addOrUpdateCertificate()" [disabled]="certificateForm.invalid">
      {{ editingCertificateIndex !== null ? 'Update Certificate' : 'Add Certificate' }}
    </button>
  </form>

  <h2 mat-subheader>Certificates</h2>
  <mat-list>
    <mat-list-item *ngFor="let cert of tempCertificates; let i = index">
      {{ cert.certificateId }} - {{ cert.issueDate }} - {{ cert.expiryDate }}
      <button mat-icon-button color="primary" (click)="editCertificate(i)">
        <mat-icon>edit</mat-icon>
      </button>
      <button mat-icon-button color="primary" (click)="removeCertificate(i)">
        <mat-icon>delete</mat-icon>
      </button>
    </mat-list-item>
  </mat-list>
</div>
<div mat-dialog-actions>
  <button mat-button (click)="onCancel()">Cancel</button>
  <button mat-button color="primary" (click)="onSave()" [disabled]="crewForm.invalid">Save</button>
</div>